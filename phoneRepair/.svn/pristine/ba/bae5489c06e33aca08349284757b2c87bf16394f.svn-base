define("component:components/libcomet/blink.js",function(t,e,n){"use strict";var o={show:function(){var t=0,e=document.title,n=setInterval(function(){t++,3==t&&(t=1),1==t&&(document.title="【　　　】"+e),2==t&&(document.title="【新消息】"+e)},500);return[n,e]},clear:function(t){t&&(clearInterval(t[0]),document.title=t[1])}};n.exports=o});
//# sourceMappingURL=//bstatic.nuomi.com/bnuomi/tuanb/static/components/libcomet/blink__5d39db6.map
;define("component:components/libcomet/comet.js",function(t,e,o){"use strict";var n=t("component:components/jquery/jquery.js");t("component:components/jquery-migrate/jquery-migrate.js");var r=t("component:components/underscore/underscore.js"),s=t("component:components/backbone/backbone.js"),i="comet",c=t("component:components/store/store.js"),a=[],u={set:function(t,e,o){c.set(t,{val:e,exp:o,time:(new Date).getTime()})},get:function(t){var e=c.get(t);return e?(new Date).getTime()-e.time>e.exp?null:e.val:null}},p="stream";n.browser.msie&&(n.browser.version<=7?p="poll":n.browser.version<=9&&(p="lpoll"));var l=function(){var t="text "+i,e={};e[t]=n.parseJSON,n.ajaxSetup({converters:e}),n.ajaxPrefilter(i,function(t){t.type="GET"}),n.ajaxTransport(i,function(t,e,o){var r=t.cometStream;return r?(r.options=n.extend(!0,{},r.options,t),r.xhr=o):r=new d(o,n.extend({cometType:i},t),e),o.cometStream=r,{send:function(t,e){r.openConnect(t,e).done(function(){var t;n.each(a,function(e,o){return o==r?(t=e,!1):void 0}),"undefined"!=typeof t&&a.splice(t,1),a.push(r)}).fail(function(){r.options.reconnectTime>0?setTimeout(function(){r.reconnect()},r.options.reconnectTime):r.reconnect()})},abort:function(){r.abort();var t=n.inArray(r,a);t>-1&&a.splice(t,1),o.cometStream=null}}})},m=function(){var t=a;t&&n.each(a,function(t,e){e.abort()})},h=function(){n(window).on("beforeunload",function(){m()})},d=function(t,e,o){this.xhr=t,this.options=n.extend({},d.DEFAULTS,e),this.originalOptions=o,this.status=-1,this.pInterval="poll"==this.options.workStyle?parseInt(this.options.pollInterval,10):parseInt(this.options.lpollInterval,10)};d.prototype._receiveData=function(t,e){c.set("msg_comet_user_lock_key",{val:9999,exp:1e5,time:(new Date).getTime()});var o=this.options.success||this.options.cometSuccess,r=t,s=r.substr(1,r.length-2).split("><"),i=s.pop(),r=n.parseJSON(i).messages;return r&&0!=r.length?(n.ajax({url:"/comet/connect/callback/receive",type:"POST",dataType:"json",data:{cometDtoJson:i}}),o&&o.call(this,t,e),void this.trigger("receive",t)):!1},d.prototype._receiveError=function(){this.trigger("receiveError")},d.prototype.openConnect=function(t,e){var o=n.Deferred(),r=this,s=this.options,i="lpoll"==this.options.workStyle||"poll"==this.options.workStyle,c=this.options.xhr();if(0!=this.status||3!=this.status){var a=!1;c.onreadystatechange=function(){var t,n,u,p={};if(4===c.readyState||3===c.readyState){r.clearTimeout&&r.clearTimeout();try{t=c.status,n=c.readyState,p.text=c.responseText}catch(l){}try{u=c.statusText}catch(l){u=""}t||!r.options.isLocal||r.options.crossDomain?1223===t&&(t=204):t=p.text?200:404}var m=t>=200&&300>t||304===t;"lpoll"==r.options.workStyle&&0==r.status&&(o.resolve(c,s),r.status=1),p.text&&m?(i?a||(r._receiveData(decodeURIComponent(encodeURI(p.text)),t),a=!0):r._receiveData(decodeURIComponent(encodeURI(p.text)),t),0==r.status&&(o.resolve(c,s),r.status=1)):t>=300&&304!==t&&(r._receiveError(null,t),0==r.status&&o.reject(c,s),e(t,u,p,c.getAllResponseHeaders())),(m&&4===n||0===t&&4===n)&&(r.pInterval>0?setTimeout(function(){r.reconnect()},r.pInterval):r.reconnect(),p&&e(200,u,p,c.getAllResponseHeaders()))},c.open(s.type,s.url,s.async,s.username,s.password),s.crossDomain||t["X-Requested-With"]||(t["X-Requested-With"]="XMLHttpRequest");for(var u in t)void 0!==t[u]&&c.setRequestHeader(u,t[u]+"");return c.send(s.hasContent&&s.data||null),this.status=0,this.setTimeout().done(function(){o.reject("timeout")}),o}},d.prototype.reconnect=function(){u.set("msg_comet_user_lock_key","999",1e5);var t=this;this.clearTimeout();var e,o=this.options;this.options.reconnect&&(e=this.options.reconnect(this)),n.when(e).done(function(e){if(t.abort(),e!==!1){t.status=4;var r=o.url&&o.url.split("?"),s=r[0],i=r[1],c={};i.replace(/([^=&]+)=([^&]*)/gi,function(t,e,o){c[e]=o}),c._&&delete c._,c.cmd="revival",n.ajax(n.extend(!0,{dataType:"comet",cometStream:t,data:c},n.isPlainObject(e)?e:{},{cache:!1,url:s,contentType:o.contentType,type:o.type,async:o.async}))}}).fail(function(){t.options.reconnectTime>0?setTimeout(function(){t.reconnect()},t.options.reconnectTime):t.reconnect()})},d.prototype.setTimeout=function(){var t=n.Deferred(),e=this,o=this.options,r=this.timeoutId;return r&&clearTimeout(r),o.cometTimeout>0?e.timeoutId=setTimeout(function(){e.timeoutId=null,e.clearTimeout=n.noop,0==e.status?(e.abort(),t.resolve()):t.reject()},o.cometTimeout):t.reject(),this.clearTimeout=function(){e.timeoutId&&(clearTimeout(e.timeoutId),e.timeoutId=null),t.reject()},t},d.prototype.abort=function(){if(this.status<1){var t=this.options.xhr();t.abort()}this.status=3,this.trigger("abort")},d.DEFAULTS={completeCallback:n.noop,cometTimeout:0,workStyle:p,reconnectTime:6e4,pollInterval:18e4,lpollInterval:2e3,autoDestroy:!0},r.extend(d.prototype,s.Events);var v=function(){l(),h()};o.exports={workStyle:p,CometStream:d,readyCometStreamQueue:a,init:v}});
//# sourceMappingURL=//bstatic.nuomi.com/bnuomi/tuanb/static/components/libcomet/comet__0e28692.map
;define("component:components/libcomet/cometContext.js",function(e){"use strict";var t,o=e("component:components/jquery/jquery.js"),n=e("component:components/store/store.js"),c=e("component:components/libcomet/comet.js"),r=null,i=null,a={set:function(e,t,o){n.set(e,{val:t,exp:o,time:(new Date).getTime()})},get:function(e){var t=n.get(e);return t?(new Date).getTime()-t.time>t.exp?null:t.val:null}},s=null,d=function(e){if(!(this instanceof d))return new d(e);if(s)return s;s=this,this.options=o.extend({},d.DEFAULT_OPTIONS,e),this._contextDeferred=o.Deferred();try{this.init()}catch(t){this.destroy()}};return d.DEFAULT_OPTIONS={userSignUrl:"/comet/connect/keys/cookie",cidStoreName:"msg_comet_user_tag_key",cometLock:"msg_comet_user_lock_key",streamLimit:1},d.prototype.inContext=function(e){var t,o=this,n=o.options.streamLimit,r=c.readyCometStreamQueue;n&&(t=r.slice(0,n)),o.getLock({cid:o.cid,stream:t,openConnect:o.openConnect,flag:!1},e);var i=o._contextDeferred,a=i.state();if("resolved"==a||"rejected"==a)o.getLock({cid:o.cid,stream:t,openConnect:o.openConnect,flag:!0},e);else{var s=function(){o.getLock({cid:o.cid,stream:t,openConnect:o.openConnect,flag:!0},e)};o._contextDeferred.done(s).fail(s)}},d.prototype.init=function(){var e=this,t=e.options.cidStoreName,o=n.get(t);o||n.set(t,"")},d.prototype.getCid=function(){var e=this,t=o.Deferred(),c=e.options.cidStoreName;n.enabled&&c||t.resolve(e.cid);var r=n.get(c);return r?t.resolve(r||e.cid):o.ajax({type:"GET",dataType:"json",url:e.options.userSignUrl,cache:!1,timeout:3e3}).done(function(o){0==o.code&&o.data?(r=o.data,e.cid=r,n.set(c,r),t.resolve(r)):t.reject(e.cid)}).fail(function(){t.reject(e.cid)}),t},d.prototype.destroy=function(){var e=this;"progress"==e._contextDeferred.state()&&e._contextDeferred.reject()},d.prototype.openConnect=function(e,i){t=!0;var a;return e.flag||(r=a=o.ajax({url:"/comet/cometServlet",cache:!1,data:{cmd:"conn",cid:n.get("msg_comet_user_tag_key"),channel:"default_comet_channel",workStyle:c.CometStream.DEFAULTS.workStyle},dataType:"comet",reconnect:function(){var e=o.Deferred(),t=new d;return t.getReconLock().done(function(){e.resolve({data:{cid:n.get("msg_comet_user_tag_key")}})}).fail(function(){e.reject()}),e}})),i&&i(e.cid,e.stream,r),a},d.prototype.getCometLock=function(e,c){var r=o.Deferred(),i=this,s=i.options.cometLock,d=i.options.cidStoreName;return e&&e.openConnect&&e.flag?(e.openConnect(e,c),!1):(o.ajax({url:"/comet/connect/keys/lock",type:"GET",dataType:"json",data:{cid:n.get(d)}}).done(function(o){if(!o.code){{o.data}t=!0,c?(a.set(s,"9999",1e5),e.openConnect&&e.openConnect(e,c)):(i._contextDeferred.resolve(),r.resolve())}}).fail(function(){r.reject()}),r)},d.prototype.getLock=function(e,t){var c=this,r=c.options.cometLock,s=c.options.cidStoreName,d=o.Deferred();return i&&e.flag?(c.getCometLock(e,t),!1):(i=setInterval(function(){return a.get(r)?d:void(n.get(s)?c.getCometLock(e,t):c.getCid().done(function(o){c.getCometLock(e,t),d.resolve(o)}).fail(function(){c._contextDeferred.reject(),d.reject()}))},5e3),d)},d.prototype.getReconLock=function(){var e=this,t=(e.options.cometLock,e.options.cidStoreName),c=o.Deferred();return o.ajax({url:"/comet/connect/callback/close",type:"GET",dataType:"json",data:{cid:n.get(t)}}).done(function(o){return 0!=o.code?!1:void setTimeout(function(){n.get(t)?e.getCometLock().done(function(){c.resolve(n.get(t))}).fail(function(){c.reject(n.get(t))}):e.getCid().done(function(t){e.getCometLock().done(function(){c.resolve(t)}).fail(function(){c.reject(t)})}).fail(function(t){e._contextDeferred.reject(),c.reject(t)})},3e3)}),c},o(window).on("beforeunload.cometContext",function(){s&&s.destroy()}),o(window).unload(function(){s&&s.destroy()}),window.onbeforeunload=function(){t&&(n.remove("msg_comet_user_lock_key"),o.ajax({url:"/comet/connect/callback/close",type:"GET",dataType:"json",data:{cid:n.get("msg_comet_user_tag_key")}}))},d});
//# sourceMappingURL=//bstatic.nuomi.com/bnuomi/tuanb/static/components/libcomet/cometContext__2fff229.map
;define("component:components/libcomet/cometMessage.js",function(e){"use strict";var t=e("component:components/jquery/jquery.js"),n=e("component:components/backbone/backbone.js"),s=e("component:components/libcomet/comet.js").CometStream,o=function(e){if(!this instanceof o)return new o(e);this.options=t.extend({},o.DEFAULT_OPTIONS,e),this.streams=[];var s=this.options.collection||o.DEFAULT_COLLECTION;this.collection=new(s.extend({parse:t.proxy(this.options.parse,this),model:this.options.model||o.DEFAULT_MODEL})),this.context=new n.Model};return o.DEFAULT_MODEL=n.Model.extend({idAttribute:"msgId"}),o.DEFAULT_COLLECTION=n.Collection.extend({comparator:function(e,t){var n=e.get("createTime"),s=t.get("createTime");return n&&s?parseInt(s,10)-parseInt(n,10):1}}),o.DEFAULT_OPTIONS={prefix:"<{",suffix:"}>",parse:function(e){var n=this,s=n.options;if(e&&e.length){var o,i,r=e.length,c=s.suffix.length,a=-1,p=e.substring(r-c,r);if(p===s.suffix){for(var m=r-1;m--;m>=0)if(m>=c-1&&(i=e.charAt(m-1)+e.charAt(m),i===s.prefix)){a=m;break}if(a>=0){o=e.substring(a,r-1);try{var h=t.parseJSON(o),f=t.extend({},h);return f.messages&&delete f.messages,n.context.set(f),h.messages}catch(u){}}}}return[]}},o.prototype.bindStream=function(e){!e||!e instanceof s||(this.streams.push(e),e.on("receive",t.proxy(this._onReceive,this)))},o.prototype.unBindStream=function(){this.streams&&this.streams.length&&(t.each(this.streams,function(e,n){n.off("receive",t.proxy(this._onReceive,this))}),this.streams=[])},o.prototype._onReceive=function(e){this.collection.add(e,{parse:!0,merge:!0,sort:!0})},o.prototype.destroy=function(){this.unBindStream()},o});
//# sourceMappingURL=//bstatic.nuomi.com/bnuomi/tuanb/static/components/libcomet/cometMessage__4e6ad57.map
;define("component:components/libcomet/tabfocus.js",function(i,e,n){"use strict";var o,t,c=i("component:components/jquery/jquery.js"),s={focus:function(){},blur:function(){}},u={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(o in u)if(o in document){t=u[o];break}t?c(document).on(t,function(){document[o]?s.blur&&s.blur():s.focus&&s.focus()}):c(window).on("blur focus",function(i){var e=c(this).data("prevType");if(e!=i.type)switch(i.type){case"blur":s.blur&&s.blur();break;case"focus":s.focus&&s.focus()}c(this).data("prevType",i.type)}),n.exports=s});
//# sourceMappingURL=//bstatic.nuomi.com/bnuomi/tuanb/static/components/libcomet/tabfocus__45cca24.map
;define("component:components/libcomet/main.js",function(e){"use strict";var t=e("component:components/jquery/jquery.js"),n=e("component:components/libcomet/cometContext.js"),o=e("component:components/libcomet/cometMessage.js"),c=e("component:components/libcomet/comet.js"),m=e("component:components/store/store.js");c.init();var i=new n,l="/comet/cometServlet",r=e("component:components/libcomet/blink.js"),u=null,a=null,s=document.title,d=function(){a&&(r.clear(a),a=null),u&&clearTimeout(u),document.title=s,a=r.show(),u=setTimeout(function(){a&&r.clear(a),a=null,document.title="【新消息】"+s},1e4)},f=e("component:components/libcomet/tabfocus.js");f.focus=function(){a&&(r.clear(a),a=null),u&&clearTimeout(u),document.title=s};var p={cometContext:i};return p.init=function(){var e=new o;return i.inContext(function(t,n,o){n=n.length?n[0]:o.cometStream,e.bindStream(n),e.collection.on("add",function(){d()})}),e},p.connectStream=function(e,n,o){var r=o||l;e||(e=m.get("msg_comet_user_tag_key"));var u=t.ajax({url:r,cache:!1,data:{cmd:"conn",cid:e,channel:"default_comet_channel",workStyle:c.CometStream.DEFAULTS.workStyle},dataType:"comet",reconnect:function(){var e=t.Deferred();return i.getCid().done(function(t){e.resolve({data:{cid:t}})}).fail(function(){e.reject()}),e}});return u},p.setNewTitle=d,p});
//# sourceMappingURL=//bstatic.nuomi.com/bnuomi/tuanb/static/components/libcomet/main__f5ef464.map
;define("component:components/libcomet/util.js",function(e){"use strict";var o=(e("component:components/jquery/jquery.js"),e("component:components/libcomet/cometMessage.js")),n=o.DEFAULT_COLLECTION.extend({model:o.DEFAULT_MODEL});return{baseCollection:n}});
//# sourceMappingURL=//bstatic.nuomi.com/bnuomi/tuanb/static/components/libcomet/util__b573d60.map